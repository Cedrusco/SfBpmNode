function CanvasJS(){var a=function(a,b,c){var d=Sfdc.canvas.oauth.client();d.oauthToken=b,Sfdc.canvas.client.subscribe(d,{name:a,onData:c})},b=function(a,b,c){var d=Sfdc.canvas.oauth.client();d.oauthToken=b,Sfdc.canvas.client.publish(d,{name:a,payload:c})};return{publish:b,subscribe:a}}function MessagingJS(a){var b=function(b,c,d,e,f){"CANVAS"==f.toUpperCase()&&a.subscribe(b,c,d)},c=function(b,c,d,e){"CANVAS"==e.toUpperCase()&&a.publish(b,c,d)};return{publish:c,subscribe:b}}MessagingJS.$inject=["CanvasJS"],angular.module("bpm-app",["ui.router","ngAnimate","ngMaterial"]),angular.module("bpm-app").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){c.html5Mode(!0).hashPrefix("!"),b.otherwise("/"),a.state("home",{url:"/",templateUrl:"/client/views/home.html"}),a.state("createOrder",{url:"/createOrder",templateUrl:"/client/views/createOrder.html"}),a.state("searchOrder",{url:"/searchOrder",templateUrl:"/client/views/searchOrder.html"}),a.state("openTasks",{url:"/openTasks",templateUrl:"/client/views/openTasks.html"})}]),angular.module("bpm-app").controller("CreateOrderCtrl",["$scope","$http","Orders",function(a,b,c){a.currentOrder={shippingAddress:{}},a.currentCustomer={},a.init=function(){a.invoice={items:[{qty:1,description:"",cost:0}]},a.$parent.canvasData&&(a.$parent.canvasData.context?(a.appLoadedFrom="salesforce",a.currentOrder.submittedBy=a.$parent.canvasData.context.user.lastName+" "+a.$parent.canvasData.context.user.firstName,a.$parent.canvasData.context.environment.parameters&&(a.currentCustomer.billingAddress={},a.currentOrder.shippingAddress={},a.currentCustomer.customerName=a.$parent.canvasData.context.environment.parameters.AccountName,a.currentCustomer.billingAddress=angular.copy(a.$parent.canvasData.context.environment.parameters.BillingAddress),a.currentOrder.shippingAddress=angular.copy(a.$parent.canvasData.context.environment.parameters.ShippingAddress))):(a.appLoadedFrom="browser",a.warning="Application not loaded from Salesforce"))},a.orderForm={currentOrder:a.currentOrder,currentCustomer:a.currentCustomer},a.removeItem=function(b){a.invoice.items.splice(b,1)},a.addItem=function(){a.invoice.items.push({qty:1,description:"",cost:0})},a.total=function(){var b=0;return angular.forEach(a.invoice.items,function(a){b+=a.qty*a.cost}),a.currentOrder.totalCost=b,b},a.description=function(){var b="Ordering "+a.invoice.items.length+" items in total, ";return angular.forEach(a.invoice.items,function(a){b+="("+a.qty+") "+a.description,b+=", "}),a.currentOrder.description=b,b},a.sendOrder=function(){c.submitOrder(a.currentOrder,a.currentCustomer).then(function(b){a.recentOrderId=b;var c=a.currentOrder.submittedBy;a.currentOrder={submittedBy:c,shippingAddress:{}},a.createOrderForm.$setPristine(),a.createOrderForm.$submitted=!1}).then(null,function(b){a.recentOrderId=b}).catch(function(b){a.recentOrderId=b})},a.updateAddress=function(){a.currentOrder.shippingAddress=angular.copy(a.currentCustomer.billingAddress)},a.init()}]),angular.module("bpm-app").controller("HomeCtrl",["$scope","processes",function(a,b){a.init=function(){b.getProcesses().then(function(b){a.processes=b.exposedItemsList})},a.init()}]),angular.module("bpm-app").controller("MainCtrl",["$scope","$location",function(a,b){a.pagename=function(){return b.path()},a.htmlRelativePath={createOrder:"/client/views/createOrder.html",searchOrder:"/client/views/searchOrder.html",openTasks:"/client/views/openTasks.html"},a.getCanvas=function(b){b&&(a.canvasData=JSON.parse(JSON.stringify(b)))}}]),angular.module("bpm-app").controller("OpenTasksCtrl",["$scope","Orders",function(a,b){a.init=function(){a.sortType="instanceId",a.sortReverse=!0,a.searchTasks()},a.error=!1,a.searchTasks=function(){a.attrResults=[],b.searchByAttribute().then(function(c){if(c!==[{instanceName:"No Results found",instanceStatus:"n/a",instanceId:"n/a"}]){if(c&&c.length>0)for(var d=0;d<c.length;d++)b.searchByTaskId(c[d].taskId).then(function(b){for(var c=a.attrResults.length-1;c>=0;c--)b.tkiid===a.attrResults[c].taskId.toString()&&(a.attrResults[c].taskDetails=b.data.variables)});a.attrResults=c,a.attrResults&&a.attrResults.length||(a.attrResults=[{instanceName:"No Results found",instanceStatus:"n/a",instanceId:"n/a"}])}else a.attrResults=c})},a.updateOrder=function(a,c){b.finishTask(a.taskId,c).then(function(b){b.error?a.errorMessage="failed to update task":a.instanceStatus="completed"})},a.init()}]),angular.module("bpm-app").controller("SearchOrderCtrl",["$scope","Orders","configFromNode","MessagingJS",function(a,b,c,d){a.currentOrder={shippingAddress:{}},a.currentCustomer={},a.orderForm={currentOrder:a.currentOrder,currentCustomer:a.currentCustomer},a.error=!1,c.getSFSearchClientSecret().then(function(b){if("No Env Variable Set"!==b)try{d.subscribe("bpmNodeOrderId",b,a.searchByPiid,a.messageError,"CANVAS"),d.subscribe("bpmNodeCustAttributes",b,a.LoadDetailsFunc,a.messageError,"CANVAS")}catch(b){a.warning="Application not loaded from Salesforce"}else a.error="No Env Varible Set"}),a.messageError=function(b){a.error="Error Occurred while subscribing onto event:  "+JSON.stringify(b)},a.searchByPiid=function(c){a.taskResult={},b.searchByPiid(c).then(function(b){"Unable to Determine Status, please check your Process Number"!==b?a.taskResult=b:(a.taskResult.currentStep=b,a.piidForm.$setPristine(),a.orderNumber=null)})},a.LoadDetailsFunc=function(b){console.log("++++++++++++++++++++++++",b),a.attr.customerName=b.accountName,a.searchByAttribute()},a.attr={},a.attrResults=!1,a.searchByAttribute=function(){a.attrResults=[],b.searchByAttribute(a.attr).then(function(c){if(console.log("Total Results for ",c),c!==[{instanceName:"No Results found",instanceStatus:"n/a",instanceId:"n/a"}]){if(c&&c.length>0)for(var d=0;d<c.length;d++)b.searchByTaskId(c[d].taskId).then(function(b){for(var c=a.attrResults.length-1;c>=0;c--)b.tkiid===a.attrResults[c].taskId.toString()&&(a.attrResults[c].taskDetails=b.data.variables)});a.attrResults=c,a.attrResults&&a.attrResults.length||(a.attrResults=[{instanceName:"No Results found",instanceStatus:"n/a",instanceId:"n/a"}]),a.attrForm.$setPristine()}else a.attrResults=c})}}]),angular.module("bpm-app").factory("configFromNode",["$q","$http",function(a,b){var c=function(){var c=a.defer();return b.get("/api/getSFSearchClientSecret").then(function(a){c.resolve(a.data)}).catch(function(a){c.resolve("No Env Variable Set")}),c.promise};return{getSFSearchClientSecret:c}}]),angular.module("bpm-app").factory("Orders",["$q","$http",function(a,b){var c=function(c,d){var e=a.defer(),c={itemID:"25.b3913c0e-fd41-480b-9948-af096b3732f9",branchID:"2063.22fc59b3-f1fe-4160-9284-c77ec43d734c",currentOrder:c,currentCustomer:d};return b.post("/api/processes/start",c).then(function(a){e.resolve(a.data.data.piid)},function(a){e.resolve("Invalid Order")}).then(null,function(){e.resolve("Invalid Order")}).catch(function(){e.resolve("Invalid Order")}),e.promise},d=function(c){var d=a.defer();return b.get("/api/status/"+c).then(function(a){d.resolve(a.data)},function(a){d.resolve("Unable to Determine Status, please check your Process Number")}).then(null,function(){d.resolve("Unable to Determine Status, please check your Process Number")}).catch(function(){d.resolve("Unable to Determine Status, please check your Process Number")}),d.promise},e=function(c){var d=a.defer();return b.post("/api/attrSearch",c).then(function(a){d.resolve(a.data.data.data)},function(a){d.resolve([{instanceName:"No Results found",instanceStatus:"n/a",instanceId:"n/a"}])}).then(null,function(){d.resolve([{instanceName:"No Results found",instanceStatus:"n/a",instanceId:"n/a"}])}),d.promise},f=function(c){var d=a.defer();return b.get("/api/taskDetails/"+c).then(function(a){d.resolve(a.data.data)},function(a){d.resolve([{instanceName:"No Results found",instanceStatus:"n/a",instanceId:"n/a"}])}).then(null,function(){d.resolve([{instanceName:"No Results found",instanceStatus:"n/a",instanceId:"n/a"}])}),d.promise},g=function(c,d){var e=a.defer();return b.post("/api/finishTask/"+c+"/"+d).then(function(a){e.resolve(a.data)},function(a){e.resolve([{instanceName:"No Results found",instanceStatus:"n/a",instanceId:"n/a"}])}),e.promise};return{submitOrder:c,searchByPiid:d,searchByAttribute:e,searchByTaskId:f,finishTask:g}}]),angular.module("bpm-app").factory("processes",["$q","$http",function(a,b){var c=function(){var c=a.defer();return b.get("/api/processes").then(function(a){c.resolve(a.data.data)}),c.promise};return{getProcesses:c}}]),angular.module("bpm-app").service("CanvasJS",CanvasJS),angular.module("bpm-app").service("MessagingJS",MessagingJS);